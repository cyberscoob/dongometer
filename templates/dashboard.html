<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Dongometer ğŸ†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 3em;
            text-shadow: 0 0 20px rgba(255, 0, 255, 0.5);
            margin-bottom: 10px;
        }
        
        .manifold-cta {
            text-decoration: none;
            display: block;
            margin-bottom: 30px;
        }
        
        .manifold-promo {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.1) 0%, rgba(255, 0, 255, 0.1) 100%);
            border: 2px solid #ff00ff;
            border-radius: 20px;
            padding: 25px 30px;
            display: flex;
            align-items: center;
            gap: 20px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            animation: manifold-pulse 3s ease-in-out infinite;
        }
        
        @keyframes manifold-pulse {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 0, 255, 0.3); }
            50% { box-shadow: 0 0 40px rgba(255, 0, 255, 0.6), 0 0 60px rgba(0, 255, 136, 0.3); }
        }
        
        .manifold-promo:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 15px 50px rgba(255, 0, 255, 0.5), 0 0 80px rgba(0, 255, 136, 0.4);
            border-color: #00ff88;
        }
        
        .manifold-glow {
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,0,255,0.1) 0%, transparent 70%);
            animation: rotate-glow 10s linear infinite;
            pointer-events: none;
        }
        
        @keyframes rotate-glow {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .manifold-icon {
            font-size: 3em;
            filter: drop-shadow(0 0 15px #ff00ff);
            animation: icon-bounce 2s ease-in-out infinite;
            z-index: 1;
        }
        
        @keyframes icon-bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .manifold-text {
            display: flex;
            flex-direction: column;
            z-index: 1;
        }
        
        .manifold-text strong {
            font-size: 1.4em;
            color: #fff;
            text-shadow: 0 0 10px rgba(255, 0, 255, 0.8);
            margin-bottom: 5px;
        }
        
        .manifold-text span {
            font-size: 0.9em;
            color: #aaa;
        }
        
        .header .subtitle {
            color: #888;
            font-size: 1.2em;
        }
        
        .nav-links {
            margin-top: 15px;
        }
        
        .nav-links a {
            color: #ff00ff;
            text-decoration: none;
            margin: 0 15px;
            padding: 8px 15px;
            border: 1px solid #ff00ff;
            border-radius: 20px;
            transition: all 0.3s ease;
        }
        
        .nav-links a:hover {
            background: #ff00ff;
            color: #fff;
            box-shadow: 0 0 20px rgba(255, 0, 255, 0.5);
        }
        
        .chaos-meter {
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid #ff00ff;
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 0 30px rgba(255, 0, 255, 0.3);
        }
        
        .chaos-label {
            font-size: 1.5em;
            margin-bottom: 15px;
            color: #ff00ff;
        }
        
        .chaos-score {
            font-size: 6em;
            font-weight: bold;
            text-shadow: 0 0 30px currentColor;
            transition: color 0.5s ease;
        }
        
        .chaos-status {
            font-size: 1.3em;
            margin-top: 15px;
            padding: 10px 20px;
            border-radius: 10px;
            display: inline-block;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .metric-card {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid #444;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        
        .metric-icon {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .metric-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #00ff88;
        }
        
        .metric-label {
            color: #888;
            font-size: 0.9em;
            margin-top: 5px;
        }
        
        .legend {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin-top: 30px;
        }
        
        .legend h3 {
            margin-bottom: 15px;
            color: #ff00ff;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 5px;
            margin-right: 10px;
        }
        
        .last-updated {
            text-align: center;
            color: #666;
            font-size: 0.8em;
            margin-top: 20px;
        }
        
        /* Chaos level colors */
        .calm { color: #00ff88; }
        .active { color: #ffff00; }
        .chaotic { color: #ff8800; }
        .demonic { color: #ff0088; }
        .apocalyptic { color: #ff0000; }
        .fenthouse { 
            /* Green weed background for Fenthouse */
            background: linear-gradient(135deg, #1a4d1a 0%, #0d330d 50%, #1a4d1a 100%) !important;
            background-color: #1a4d1a !important;
        }
        
        .fenthouse .chaos-score {
            /* Rainbow chaos number with rotating hue shadows */
            color: #ff0000;
            text-shadow: 
                3px 0 #ff8800,
                -3px 0 #00ff00,
                0 3px #0088ff,
                0 -3px #ffff00;
            animation: rainbow-hue 2s linear infinite;
        }
        
        @keyframes rainbow-hue {
            0% { filter: hue-rotate(0deg); }
            100% { filter: hue-rotate(360deg); }
        }
        
        @keyframes rainbow-text {
            0% { color: #ff0000; }
            20% { color: #ff8800; }
            40% { color: #ffff00; }
            60% { color: #00ff88; }
            80% { color: #0088ff; }
            100% { color: #ff0000; }
        }
        
        .fenthouse .chaos-status {
            /* White/clean status text on green */
            color: #fff;
            text-shadow: 0 0 10px #00ff00;
        }
        
        @keyframes rainbow {
            0% { filter: hue-rotate(0deg); }
            100% { filter: hue-rotate(360deg); }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .updating {
            animation: pulse 0.5s ease-in-out;
        }
    
        /* Enhanced Animations */
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px currentColor; }
            50% { box-shadow: 0 0 40px currentColor, 0 0 60px currentColor; }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        @keyframes particle {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(-100px) rotate(360deg); opacity: 0; }
        }
        
        .chaos-score {
            animation: float 3s ease-in-out infinite, glow 2s ease-in-out infinite;
        }
        
        .chaotic .chaos-score {
            animation: float 2s ease-in-out infinite, glow 1s ease-in-out infinite, shake 0.5s ease-in-out infinite;
        }
        
        .demonic .chaos-score {
            animation: float 1s ease-in-out infinite, glow 0.5s ease-in-out infinite, shake 0.2s ease-in-out infinite;
        }
        
        .metric-value {
            transition: all 0.3s ease;
        }
        
        .metric-value.updating {
            transform: scale(1.2);
            text-shadow: 0 0 20px currentColor;
        }
        
        .metric-card:hover {
            animation: glow 1s ease-in-out infinite;
        }
        
        .legend-item {
            transition: all 0.3s ease;
        }
        
        .legend-item:hover {
            transform: translateX(10px);
        }
        
        /* Dong Analytics Bar Graph */
        .analytics-section {
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid #ff00ff;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .analytics-section h3 {
            text-align: center;
            margin-bottom: 20px;
            color: #ff00ff;
            text-shadow: 0 0 10px #ff00ff;
        }
        
        .dong-analytics {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .analytics-bar {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .bar-label {
            width: 100px;
            text-align: right;
            font-size: 0.9em;
            color: #ccc;
            text-transform: capitalize;
        }
        
        .bar-track {
            flex: 1;
            height: 25px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            overflow: hidden;
            position: relative;
        }
        
        .bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff0088, #ff00ff);
            border-radius: 5px;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 8px;
        }
        
        .bar-value {
            font-size: 0.85em;
            font-weight: bold;
            color: #fff;
            text-shadow: 0 0 5px #000;
        }
        
        .fenthouse .bar-fill {
            background: linear-gradient(90deg, #00ff88, #ff00ff, #ff0000);
            animation: rainbow-hue 3s linear infinite;
        }
        
        /* Chaos Progress Bar */
        .chaos-meter-container {
            width: 100%;
            max-width: 600px;
            margin: 20px auto 0;
        }
        
        .chaos-progress-bar {
            width: 100%;
            height: 30px;
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #ff00ff;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
        }
        
        .chaos-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ff88 0%, #ffff00 25%, #ff8800 50%, #ff0000 75%, #ff00ff 100%);
            border-radius: 13px;
            transition: width 0.3s ease;
            position: relative;
        }
        
        .chaos-progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .chaos-meter-label {
            text-align: center;
            margin-top: 8px;
            font-size: 0.9em;
            color: #888;
        }
        
        /* Violent shaking for chaos > 100 */
        .chaos-meter-container.shaking-low {
            animation: violent-shake 0.5s ease-in-out infinite;
        }
        
        .chaos-meter-container.shaking-medium {
            animation: violent-shake 0.3s ease-in-out infinite;
        }
        
        .chaos-meter-container.shaking-high {
            animation: violent-shake 0.15s ease-in-out infinite;
        }
        
        .chaos-meter-container.shaking-extreme {
            animation: violent-shake 0.08s ease-in-out infinite;
        }
        
        @keyframes violent-shake {
            0%, 100% { transform: translateX(0) rotate(0deg); }
            10% { transform: translateX(-5px) rotate(-1deg); }
            20% { transform: translateX(5px) rotate(1deg); }
            30% { transform: translateX(-8px) rotate(-2deg); }
            40% { transform: translateX(8px) rotate(2deg); }
            50% { transform: translateX(-5px) rotate(-1deg); }
            60% { transform: translateX(5px) rotate(1deg); }
            70% { transform: translateX(-3px) rotate(-0.5deg); }
            80% { transform: translateX(3px) rotate(0.5deg); }
            90% { transform: translateX(-1px) rotate(-0.25deg); }
        }
        
        /* CClub's Favorite Word Banner */
        .favorite-word-banner {
            background: linear-gradient(135deg, #ff00ff 0%, #8800ff 50%, #ff0088 100%);
            border: 3px solid #fff;
            border-radius: 20px;
            padding: 25px;
            margin: 20px auto 30px;
            max-width: 600px;
            text-align: center;
            box-shadow: 0 0 40px rgba(255, 0, 255, 0.5);
            animation: banner-pulse 2s ease-in-out infinite;
        }
        
        @keyframes banner-pulse {
            0%, 100% { box-shadow: 0 0 40px rgba(255, 0, 255, 0.5); }
            50% { box-shadow: 0 0 60px rgba(255, 0, 255, 0.8), 0 0 80px rgba(255, 0, 255, 0.4); }
        }
        
        .banner-label {
            font-size: 0.9em;
            color: #fff;
            text-transform: uppercase;
            letter-spacing: 3px;
            margin-bottom: 10px;
            text-shadow: 0 0 10px #fff;
        }
        
        .banner-word {
            font-size: 3.5em;
            font-weight: bold;
            color: #fff;
            text-shadow: 0 0 20px #fff, 0 0 40px #ff00ff, 0 0 60px #ff00ff;
            text-transform: uppercase;
            letter-spacing: 5px;
            animation: word-glow 1.5s ease-in-out infinite;
        }
        
        @keyframes word-glow {
            0%, 100% { text-shadow: 0 0 20px #fff, 0 0 40px #ff00ff; }
            50% { text-shadow: 0 0 30px #fff, 0 0 60px #ff00ff, 0 0 80px #ff00ff; }
        }
        
        .banner-count {
            font-size: 1.2em;
            color: #fff;
            margin-top: 10px;
            text-shadow: 0 0 5px #fff;
        }
        
        .top-words {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .top-word-item {
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.85em;
            color: #fff;
        }
</style>
</head>
<body>
    <div class="header">
        <h1>ğŸ† THE DONGOMETER ğŸ†</h1>
        <p class="subtitle">Real-time Donghouse Chaos Metrics</p>
        <div class="nav-links">
            <a href="/">ğŸ“Š Dashboard</a>
            <a href="/manifold">ğŸŒŒ Manifold 2D</a>
            <a href="/manifold3d">ğŸŒ  Manifold 3D</a>
            <a href="/fentviz" style="background: linear-gradient(90deg, #f00, #ff0, #0f0, #0ff, #00f, #f0f, #f00); background-size: 200% auto; animation: rainbow 3s linear infinite; -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: bold;">ğŸŒ¿ FENTVIZ</a>
            <a href="/indexer">ğŸ“ˆ Indexer</a>
        </div>
        <style>@keyframes rainbow { 0% { background-position: 0% 50%; } 100% { background-position: 200% 50%; } }</style>
    </div>
    
    <a href="/manifold" class="manifold-cta">
        <div class="manifold-promo">
            <div class="manifold-glow"></div>
            <span class="manifold-icon">ğŸŒŠ</span>
            <div class="manifold-text">
                <strong>ğŸŒŒ ENTER THE DONG MANIFOLD</strong>
                <span>Real-time chaos visualization with live particle effects â†’</span>
            </div>
        </div>
    </a>
    
    <div class="chaos-meter">
        <div class="chaos-label">CURRENT CHAOS LEVEL</div>
        <div class="chaos-score" id="chaosScore">0.0</div>
        <div class="chaos-status" id="chaosStatus">Initializing...</div>
        
        <!-- Chaos Progress Bar -->
        <div class="chaos-meter-container" id="chaosMeterContainer">
            <div class="chaos-progress-bar">
                <div class="chaos-progress-fill" id="chaosProgressFill" style="width: 0%"></div>
            </div>
            <div class="chaos-meter-label" id="chaosMeterLabel">0 / 42069</div>
        </div>
        
        <div class="fenthouse-countdown" id="fenthouseCountdown" style="display: none; margin-top: 15px; padding: 10px 20px; background: linear-gradient(90deg, #ff0000, #ff8800, #ffff00, #00ff88, #0088ff, #8800ff); color: #000; font-weight: bold; border-radius: 10px; font-family: 'Courier New', monospace; font-size: 1.5em; text-shadow: none;">
            â° FENTHOUSE EXPIRES: <span id="countdownTimer">--:--:--</span>
        </div>
    </div>
    
    <div class="metrics-grid">
        <div class="metric-card">
            <div class="metric-icon">ğŸ’¬</div>
            <div class="metric-value" id="chat5min">0</div>
            <div class="metric-label">Messages (5 min)</div>
        </div>
        
        <div class="metric-card">
            <div class="metric-icon">ğŸšª</div>
            <div class="metric-value" id="door10min">0</div>
            <div class="metric-label">Door Events (10 min)</div>
        </div>
        
        <div class="metric-card">
            <div class="metric-icon">ğŸ•</div>
            <div class="metric-value" id="pizzaCount">0</div>
            <div class="metric-label">Pizza Count</div>
        </div>
        
        <div class="metric-card">
            <div class="metric-icon">ğŸŒ­</div>
            <div class="metric-value" id="glizzCount">0</div>
            <div class="metric-label">Glizzy Count</div>
        </div>
        
        <div class="metric-card">
            <div class="metric-icon">ğŸ†</div>
            <div class="metric-value" id="dongCount">0</div>
            <div class="metric-label">Dong+ Variants (24h)</div>
        </div>
        
        <div class="metric-card">
            <div class="metric-icon">ğŸ“Š</div>
            <div class="metric-value" id="chat1hour">0</div>
            <div class="metric-label">Messages (1 hour)</div>
        </div>
        
        <div class="metric-card">
            <div class="metric-icon">ğŸ—„ï¸</div>
            <div class="metric-value" id="indexerCount">-</div>
            <div class="metric-label">Matrix Indexed Events</div>
        </div>
    </div>
    
    <!-- CClub's Favorite Word Banner -->
    <div class="favorite-word-banner" id="favoriteWordBanner" style="display: none;">
        <div class="banner-label">ğŸ† CCLUB'S FAVORITE WORD</div>
        <div class="banner-word" id="favoriteWord">...</div>
        <div class="banner-count" id="favoriteWordCount">0 mentions</div>
        <div class="top-words" id="topWords"></div>
    </div>
    
    <!-- Dong Analytics Bar Graph -->
    <div class="analytics-section">
        <div style="display: flex; justify-content: center; align-items: center; gap: 15px; margin-bottom: 20px;">
            <h3 style="margin: 0;">ğŸ† Dong Variant Analytics</h3>
            <select id="dongTimeRange" style="background: rgba(0,0,0,0.5); border: 1px solid #ff00ff; color: #fff; padding: 8px 12px; border-radius: 5px; font-family: 'Courier New', monospace; cursor: pointer;">
                <option value="24h">Last 24 Hours</option>
                <option value="all">All Time</option>
            </select>
        </div>
        <div class="dong-analytics" id="dongAnalytics">
            <!-- Bars will be rendered here -->
        </div>
    </div>
    
    <div class="legend">
        <h3>ğŸ“ˆ Chaos Scale Reference</h3>
        <div class="legend-item">
            <div class="legend-color calm" style="background: #00ff88;"></div>
            <span><strong>0-20:</strong> Calm â€” The donghouse sleeps</span>
        </div>
        <div class="legend-item">
            <div class="legend-color active" style="background: #ffff00;"></div>
            <span><strong>21-40:</strong> Active â€” Normal operations</span>
        </div>
        <div class="legend-item">
            <div class="legend-color chaotic" style="background: #ff8800;"></div>
            <span><strong>41-60:</strong> Chaotic â€” Pizza's here, someone's compiling</span>
        </div>
        <div class="legend-item">
            <div class="legend-color demonic" style="background: #ff0088;"></div>
            <span><strong>61-80:</strong> Demonic â€” Hardin needs a grader, Yakko is down</span>
        </div>
        <div class="legend-item">
            <div class="legend-color apocalyptic" style="background: #ff0000;"></div>
            <span><strong>81-100:</strong> Apocalyptic â€” Gigglesgate 2.0, run</span>
        </div>
        <div class="legend-item">
            <div class="legend-color fenthouse" style="background: linear-gradient(90deg, #ff0000, #ff8800, #ffff00, #00ff88, #0088ff, #8800ff);"></div>
            <span><strong>42069+:</strong> ğŸŒ¿ Fenthouse â€” Folding in the Fenthouse</span>
        </div>
    </div>
    
    <div class="last-updated" id="lastUpdated">Last updated: Never</div>
    
    <script>
        let lastData = null;
        
        function getChaosClass(score) {
            if (score >= 42069) return 'fenthouse';
            if (score <= 20) return 'calm';
            if (score <= 40) return 'active';
            if (score <= 60) return 'chaotic';
            if (score <= 80) return 'demonic';
            return 'apocalyptic';
        }
        
        function getChaosLabel(score) {
            if (score >= 42069) return 'ğŸŒ¿ Fenthouse â€” Folding in the Fenthouse';
            if (score <= 20) return 'ğŸ˜´ CALM â€” The donghouse sleeps';
            if (score <= 40) return 'âš¡ ACTIVE â€” Normal operations';
            if (score <= 60) return 'ğŸ• CHAOTIC â€” Pizza\'s here';
            if (score <= 80) return 'ğŸ‘¿ DEMONIC â€” Hardin needs a grader';
            return 'â˜ ï¸ APOCALYPTIC â€” Gigglesgate 2.0';
        }
        
        async function updateMetrics() {
            try {
                const response = await fetch('/api/metrics');
                const data = await response.json();
                
                // Update chaos score with animation
                const scoreEl = document.getElementById('chaosScore');
                const oldScore = parseFloat(scoreEl.textContent);
                const newScore = data.chaos_score;
                
                if (oldScore !== newScore) {
                    scoreEl.classList.add('updating');
                    setTimeout(() => scoreEl.classList.remove('updating'), 500);
                }
                
                // Apply chaos class to body for global effects
                const chaosClass = getChaosClass(newScore);
                document.body.className = chaosClass;
                
                scoreEl.textContent = newScore.toFixed(1);
                scoreEl.className = 'chaos-score ' + chaosClass;
                
                // Update status
                const statusEl = document.getElementById('chaosStatus');
                statusEl.textContent = data.status || getChaosLabel(newScore);
                statusEl.className = 'chaos-status ' + chaosClass;
                
                // Update Chaos Progress Bar
                const progressFill = document.getElementById('chaosProgressFill');
                const meterLabel = document.getElementById('chaosMeterLabel');
                const meterContainer = document.getElementById('chaosMeterContainer');
                
                // Calculate width - logarithmic scale for better visualization
                // At 42069 chaos = 100% bar, anything beyond shows as full
                let progressWidth = Math.min((newScore / 42069) * 100, 100);
                if (newScore > 42069) {
                    progressWidth = 100;
                }
                progressFill.style.width = progressWidth + '%';
                
                // Update label with current/max
                const targetValue = newScore >= 42069 ? 'âˆ' : '42069';
                meterLabel.textContent = `${Math.floor(newScore)} / ${targetValue}`;
                
                // Apply violent shaking when chaos > 100, increasing intensity up to 42069
                meterContainer.classList.remove('shaking-low', 'shaking-medium', 'shaking-high', 'shaking-extreme');
                if (newScore > 100 && newScore < 42069) {
                    if (newScore < 1000) {
                        meterContainer.classList.add('shaking-low');
                    } else if (newScore < 5000) {
                        meterContainer.classList.add('shaking-medium');
                    } else if (newScore < 20000) {
                        meterContainer.classList.add('shaking-high');
                    } else {
                        meterContainer.classList.add('shaking-extreme');
                    }
                }
                
                // Update Fenthouse countdown
                const countdownDiv = document.getElementById('fenthouseCountdown');
                const countdownTimer = document.getElementById('countdownTimer');
                if (data.fenthouse_countdown) {
                    const { hours, minutes, seconds } = data.fenthouse_countdown;
                    countdownDiv.style.display = 'inline-block';
                    countdownTimer.textContent = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                } else {
                    countdownDiv.style.display = 'none';
                }
                
                // Update metrics with animation (including glizz and dong!)
                const metricsIds = ['chat5min', 'door10min', 'pizzaCount', 'glizzCount', 'dongCount', 'chat1hour'];
                const metricData = [data.chat_velocity_5min, data.door_events_10min, data.pizza_count, data.glizz_count, data.dong_count, data.chat_velocity_1hour];
                
                metricsIds.forEach((id, index) => {
                    const el = document.getElementById(id);
                    const oldVal = parseInt(el.textContent);
                    const newVal = metricData[index] || 0;
                    
                    if (oldVal !== newVal) {
                        el.classList.add('updating');
                        setTimeout(() => el.classList.remove('updating'), 300);
                    }
                    el.textContent = newVal;
                });
                
                // Update timestamp
                if (data.last_updated) {
                    const date = new Date(data.last_updated);
                    document.getElementById('lastUpdated').textContent = 
                        'Last updated: ' + date.toLocaleString();
                }
                
                // Update Matrix indexer count if available
                if (data.matrix_indexer_messages !== null && data.matrix_indexer_messages !== undefined) {
                    const indexerEl = document.getElementById('indexerCount');
                    indexerEl.textContent = data.matrix_indexer_messages.toLocaleString();
                }
                
                // Update Dong Analytics Bar Graph
                renderDongAnalytics(data);
                
                // Update Favorite Word Banner
                if (data.favorite_word) {
                    const banner = document.getElementById('favoriteWordBanner');
                    const wordEl = document.getElementById('favoriteWord');
                    const countEl = document.getElementById('favoriteWordCount');
                    const topWordsEl = document.getElementById('topWords');
                    
                    banner.style.display = 'block';
                    wordEl.textContent = data.favorite_word.word;
                    countEl.textContent = data.favorite_word.count.toLocaleString() + ' mentions';
                    
                    if (data.top_words && data.top_words.length > 1) {
                        topWordsEl.innerHTML = data.top_words.slice(1, 4).map(w => 
                            `<span class="top-word-item">${w.word}: ${w.count.toLocaleString()}</span>`
                        ).join('');
                    }
                }
                
                lastData = data;
            } catch (error) {
                console.error('Failed to fetch metrics:', error);
                document.getElementById('lastUpdated').textContent = 
                    'Last updated: Connection lost';
            }
        }
        
        // Update every 1 second for smooth real-time chaos
        updateMetrics();
        setInterval(updateMetrics, 1000);
        
        // Function to render dong analytics
        function renderDongAnalytics(data) {
            const timeRange = document.getElementById('dongTimeRange').value;
            const analyticsData = timeRange === 'all' ? data.dong_analytics_all_time : data.dong_analytics;
            
            if (analyticsData) {
                const analyticsEl = document.getElementById('dongAnalytics');
                const variants = Object.entries(analyticsData).sort((a, b) => b[1] - a[1]);
                const maxCount = Math.max(...variants.map(v => v[1]), 1);
                
                analyticsEl.innerHTML = variants.map(([name, count]) => {
                    const width = (count / maxCount * 100).toFixed(1);
                    return `
                        <div class="analytics-bar">
                            <div class="bar-label">${name}</div>
                            <div class="bar-track">
                                <div class="bar-fill" style="width: ${width}%">
                                    <span class="bar-value">${count.toLocaleString()}</span>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('') || '<div style="text-align: center; color: #666;">No data available</div>';
            }
        }
        
        // Dong time range dropdown handler
        document.getElementById('dongTimeRange')?.addEventListener('change', function() {
            if (lastData) {
                renderDongAnalytics(lastData);
            }
        });
        
        // Keyboard shortcut for chaos
        document.addEventListener('keydown', (e) => {
            if (e.key === 'c' && e.ctrlKey) {
                e.preventDefault();
                alert('Chaos Level: ' + (lastData?.chaos_score || 'Unknown'));
            }
        });
    </script>
</body>
</html>
