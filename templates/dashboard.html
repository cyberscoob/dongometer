<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Dongometer üçÜ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 3em;
            text-shadow: 0 0 20px rgba(255, 0, 255, 0.5);
            margin-bottom: 10px;
        }
        
        .header .subtitle {
            color: #888;
            font-size: 1.2em;
        }
        
        .chaos-meter {
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid #ff00ff;
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 0 30px rgba(255, 0, 255, 0.3);
        }
        
        .chaos-label {
            font-size: 1.5em;
            margin-bottom: 15px;
            color: #ff00ff;
        }
        
        .chaos-score {
            font-size: 6em;
            font-weight: bold;
            text-shadow: 0 0 30px currentColor;
            transition: color 0.5s ease;
        }
        
        .chaos-status {
            font-size: 1.3em;
            margin-top: 15px;
            padding: 10px 20px;
            border-radius: 10px;
            display: inline-block;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .metric-card {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid #444;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        
        .metric-icon {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .metric-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #00ff88;
        }
        
        .metric-label {
            color: #888;
            font-size: 0.9em;
            margin-top: 5px;
        }
        
        .legend {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin-top: 30px;
        }
        
        .legend h3 {
            margin-bottom: 15px;
            color: #ff00ff;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 5px;
            margin-right: 10px;
        }
        
        .last-updated {
            text-align: center;
            color: #666;
            font-size: 0.8em;
            margin-top: 20px;
        }
        
        /* Chaos level colors */
        .calm { color: #00ff88; }
        .active { color: #ffff00; }
        .chaotic { color: #ff8800; }
        .demonic { color: #ff0088; }
        .apocalyptic { color: #ff0000; }
        .fenthouse { 
            /* Green weed background for Fenthouse */
            background: linear-gradient(135deg, #1a4d1a 0%, #0d330d 50%, #1a4d1a 100%) !important;
            background-color: #1a4d1a !important;
        }
        
        .fenthouse .chaos-score {
            /* Rainbow chaos number - solid colors */
            color: #ff00ff;
            text-shadow: 
                2px 0 #ff0000,
                -2px 0 #00ff00,
                0 2px #0088ff,
                0 -2px #ffff00;
            animation: rainbow-text 2s linear infinite;
        }
        
        @keyframes rainbow-text {
            0% { color: #ff0000; }
            20% { color: #ff8800; }
            40% { color: #ffff00; }
            60% { color: #00ff88; }
            80% { color: #0088ff; }
            100% { color: #ff0000; }
        }
        
        .fenthouse .chaos-status {
            /* White/clean status text on green */
            color: #fff;
            text-shadow: 0 0 10px #00ff00;
        }
        
        @keyframes rainbow {
            0% { filter: hue-rotate(0deg); }
            100% { filter: hue-rotate(360deg); }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .updating {
            animation: pulse 0.5s ease-in-out;
        }
    
        /* Enhanced Animations */
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px currentColor; }
            50% { box-shadow: 0 0 40px currentColor, 0 0 60px currentColor; }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        @keyframes particle {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(-100px) rotate(360deg); opacity: 0; }
        }
        
        .chaos-score {
            animation: float 3s ease-in-out infinite, glow 2s ease-in-out infinite;
        }
        
        .chaotic .chaos-score {
            animation: float 2s ease-in-out infinite, glow 1s ease-in-out infinite, shake 0.5s ease-in-out infinite;
        }
        
        .demonic .chaos-score {
            animation: float 1s ease-in-out infinite, glow 0.5s ease-in-out infinite, shake 0.2s ease-in-out infinite;
        }
        
        .metric-value {
            transition: all 0.3s ease;
        }
        
        .metric-value.updating {
            transform: scale(1.2);
            text-shadow: 0 0 20px currentColor;
        }
        
        .metric-card:hover {
            animation: glow 1s ease-in-out infinite;
        }
        
        .legend-item {
            transition: all 0.3s ease;
        }
        
        .legend-item:hover {
            transform: translateX(10px);
        }
</style>
</head>
<body>
    <div class="header">
        <h1>üçÜ THE DONGOMETER üçÜ</h1>
        <p class="subtitle">Real-time Donghouse Chaos Metrics</p>
    </div>
    
    <div class="chaos-meter">
        <div class="chaos-label">CURRENT CHAOS LEVEL</div>
        <div class="chaos-score" id="chaosScore">0.0</div>
        <div class="chaos-status" id="chaosStatus">Initializing...</div>
    </div>
    
    <div class="metrics-grid">
        <div class="metric-card">
            <div class="metric-icon">üí¨</div>
            <div class="metric-value" id="chat5min">0</div>
            <div class="metric-label">Messages (5 min)</div>
        </div>
        
        <div class="metric-card">
            <div class="metric-icon">üö™</div>
            <div class="metric-value" id="door10min">0</div>
            <div class="metric-label">Door Events (10 min)</div>
        </div>
        
        <div class="metric-card">
            <div class="metric-icon">üçï</div>
            <div class="metric-value" id="pizzaCount">0</div>
            <div class="metric-label">Pizza Count</div>
        </div>
        
        <div class="metric-card">
            <div class="metric-icon">üìä</div>
            <div class="metric-value" id="chat1hour">0</div>
            <div class="metric-label">Messages (1 hour)</div>
        </div>
        
        <div class="metric-card">
            <div class="metric-icon">üóÑÔ∏è</div>
            <div class="metric-value" id="indexerCount">-</div>
            <div class="metric-label">Matrix Indexed Events</div>
        </div>
    </div>
    
    <div class="legend">
        <h3>üìà Chaos Scale Reference</h3>
        <div class="legend-item">
            <div class="legend-color calm" style="background: #00ff88;"></div>
            <span><strong>0-20:</strong> Calm ‚Äî The donghouse sleeps</span>
        </div>
        <div class="legend-item">
            <div class="legend-color active" style="background: #ffff00;"></div>
            <span><strong>21-40:</strong> Active ‚Äî Normal operations</span>
        </div>
        <div class="legend-item">
            <div class="legend-color chaotic" style="background: #ff8800;"></div>
            <span><strong>41-60:</strong> Chaotic ‚Äî Pizza's here, someone's compiling</span>
        </div>
        <div class="legend-item">
            <div class="legend-color demonic" style="background: #ff0088;"></div>
            <span><strong>61-80:</strong> Demonic ‚Äî Hardin needs a grader, Yakko is down</span>
        </div>
        <div class="legend-item">
            <div class="legend-color apocalyptic" style="background: #ff0000;"></div>
            <span><strong>81-100:</strong> Apocalyptic ‚Äî Gigglesgate 2.0, run</span>
        </div>
        <div class="legend-item">
            <div class="legend-color fenthouse" style="background: linear-gradient(90deg, #ff0000, #ff8800, #ffff00, #00ff88, #0088ff, #8800ff);"></div>
            <span><strong>42069+:</strong> üåø Fenthouse ‚Äî Folding in the Fenthouse</span>
        </div>
    </div>
    
    <div class="last-updated" id="lastUpdated">Last updated: Never</div>
    
    <script>
        let lastData = null;
        
        function getChaosClass(score) {
            if (score >= 42069) return 'fenthouse';
            if (score <= 20) return 'calm';
            if (score <= 40) return 'active';
            if (score <= 60) return 'chaotic';
            if (score <= 80) return 'demonic';
            return 'apocalyptic';
        }
        
        function getChaosLabel(score) {
            if (score >= 42069) return 'üåø Fenthouse ‚Äî Folding in the Fenthouse';
            if (score <= 20) return 'üò¥ CALM ‚Äî The donghouse sleeps';
            if (score <= 40) return '‚ö° ACTIVE ‚Äî Normal operations';
            if (score <= 60) return 'üçï CHAOTIC ‚Äî Pizza\'s here';
            if (score <= 80) return 'üëø DEMONIC ‚Äî Hardin needs a grader';
            return '‚ò†Ô∏è APOCALYPTIC ‚Äî Gigglesgate 2.0';
        }
        
        async function updateMetrics() {
            try {
                const response = await fetch('/api/metrics');
                const data = await response.json();
                
                // Update chaos score with animation
                const scoreEl = document.getElementById('chaosScore');
                const oldScore = parseFloat(scoreEl.textContent);
                const newScore = data.chaos_score;
                
                if (oldScore !== newScore) {
                    scoreEl.classList.add('updating');
                    setTimeout(() => scoreEl.classList.remove('updating'), 500);
                }
                
                // Apply chaos class to body for global effects
                const chaosClass = getChaosClass(newScore);
                document.body.className = chaosClass;
                
                scoreEl.textContent = newScore.toFixed(1);
                scoreEl.className = 'chaos-score ' + chaosClass;
                
                // Update status
                const statusEl = document.getElementById('chaosStatus');
                statusEl.textContent = data.status || getChaosLabel(newScore);
                statusEl.className = 'chaos-status ' + chaosClass;
                
                // Update metrics with animation
                const metricsIds = ['chat5min', 'door10min', 'pizzaCount', 'chat1hour'];
                const metricData = [data.chat_velocity_5min, data.door_events_10min, data.pizza_count, data.chat_velocity_1hour];
                
                metricsIds.forEach((id, index) => {
                    const el = document.getElementById(id);
                    const oldVal = parseInt(el.textContent);
                    const newVal = metricData[index] || 0;
                    
                    if (oldVal !== newVal) {
                        el.classList.add('updating');
                        setTimeout(() => el.classList.remove('updating'), 300);
                    }
                    el.textContent = newVal;
                });
                
                // Update timestamp
                if (data.last_updated) {
                    const date = new Date(data.last_updated);
                    document.getElementById('lastUpdated').textContent = 
                        'Last updated: ' + date.toLocaleString();
                }
                
                // Update Matrix indexer count if available
                if (data.matrix_indexer_messages !== null && data.matrix_indexer_messages !== undefined) {
                    const indexerEl = document.getElementById('indexerCount');
                    indexerEl.textContent = data.matrix_indexer_messages.toLocaleString();
                }
                
                lastData = data;
            } catch (error) {
                console.error('Failed to fetch metrics:', error);
                document.getElementById('lastUpdated').textContent = 
                    'Last updated: Connection lost';
            }
        }
        
        // Update every 5 seconds
        updateMetrics();
        setInterval(updateMetrics, 5000);
        
        // Keyboard shortcut for chaos
        document.addEventListener('keydown', (e) => {
            if (e.key === 'c' && e.ctrlKey) {
                e.preventDefault();
                alert('Chaos Level: ' + (lastData?.chaos_score || 'Unknown'));
            }
        });
    </script>
</body>
</html>
